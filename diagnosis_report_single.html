<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¤é¥®åº—ç›ˆåˆ©AIè¯Šæ–­æŠ¥å‘Š v2 - å•æ–‡ä»¶ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com/3.3.3"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        /* V2 é¤é¥®åº—ç›ˆåˆ©AIè¯Šæ–­æŠ¥å‘Šæ ·å¼ */
        .store-overview-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .store-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-top: 16px;
        }

        .store-info-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .store-info-icon {
            font-size: 18px;
            width: 24px;
            text-align: center;
        }

        .health-level-badge {
            display: inline-block;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-top: 12px;
        }

        .health-excellent { background: #dcfce7; color: #166534; }
        .health-good { background: #dbeafe; color: #1e40af; }
        .health-warning { background: #fef3c7; color: #92400e; }
        .health-danger { background: #fee2e2; color: #991b1b; }

        /* ä»ªè¡¨ç›˜æ ·å¼ */
        .dashboard-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin: 24px 0;
        }

        .gauge-chart {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            text-align: center;
        }

        .radar-chart {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        /* æˆæœ¬åˆ†ææ ·å¼ */
        .cost-analysis-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin: 24px 0;
        }

        .pie-chart-container {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .alert-panel {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .alert-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            margin: 8px 0;
            border-radius: 8px;
            border-left: 4px solid;
        }

        .alert-warning { background: #fef3c7; border-left-color: #f59e0b; }
        .alert-danger { background: #fee2e2; border-left-color: #ef4444; }
        .alert-info { background: #dbeafe; border-left-color: #3b82f6; }

        /* AIå»ºè®®å¡ç‰‡æ ·å¼ */
        .ai-suggestion-card {
            background: white;
            border-radius: 12px;
            margin: 16px 0;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .suggestion-header {
            padding: 20px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #e5e7eb;
        }

        .suggestion-content {
            padding: 20px;
            display: none;
        }

        .suggestion-content.expanded {
            display: block;
        }

        .priority-high { border-left: 4px solid #ef4444; }
        .priority-medium { border-left: 4px solid #f59e0b; }
        .priority-low { border-left: 4px solid #22c55e; }

        /* ç®¡ç†å‘˜ç¼–è¾‘å™¨æ ·å¼ */
        .admin-editor {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin: 24px 0;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .editor-toolbar {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            padding-bottom: 16px;
            border-bottom: 1px solid #e5e7eb;
        }

        .editor-btn {
            padding: 8px 16px;
            border: 1px solid #d1d5db;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }

        .editor-btn:hover {
            background: #f9fafb;
        }

        .editor-btn.active {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }

        .editor-content {
            min-height: 200px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            padding: 16px;
            font-family: inherit;
        }

        /* ä¸»é¢˜æ ·å¼ */
        .theme-fresh {
            --primary-color: #22c55e;
            --secondary-color: #f0fdf4;
            --accent-color: #16a34a;
        }

        .theme-professional {
            --primary-color: #3b82f6;
            --secondary-color: #f8fafc;
            --accent-color: #1e40af;
        }

        .theme-business {
            --primary-color: #f59e0b;
            --secondary-color: #fffbeb;
            --accent-color: #d97706;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .dashboard-container,
            .cost-analysis-container {
                grid-template-columns: 1fr;
            }
            
            .store-info-grid {
                grid-template-columns: 1fr;
            }
        }

        .diagnosis-section {
            margin: 24px 0;
            padding: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="container mx-auto p-6">
        <h1 class="text-3xl font-bold text-center mb-8">é¤é¥®åº—ç›ˆåˆ©AIè¯Šæ–­æŠ¥å‘Š v2</h1>
        
        <div class="mb-6 flex justify-center gap-4">
            <button onclick="generateTestReport()" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š
            </button>
            <button onclick="exportToPDF()" class="px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700">
                å¯¼å‡ºPDF
            </button>
            <button onclick="exportToImage()" class="px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700">
                å¯¼å‡ºå›¾ç‰‡
            </button>
        </div>

        <div class="mb-6 flex justify-center gap-4">
            <label class="font-semibold">ä¸»é¢˜é€‰æ‹©ï¼š</label>
            <select id="themeSelector" onchange="changeTheme(this.value)" class="px-4 py-2 border border-gray-300 rounded-lg">
                <option value="fresh">ğŸŒ¿ æ¸…æ–°ä¸»é¢˜</option>
                <option value="professional">âš™ï¸ ä¸“ä¸šä¸»é¢˜</option>
                <option value="business">ğŸ’¼ å•†åŠ¡ä¸»é¢˜</option>
            </select>
        </div>

        <div id="reportExport" class="diagnosis-report-v2 theme-fresh">
            <div class="text-center text-gray-500 py-20">
                ç‚¹å‡»"ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š"æŒ‰é’®æŸ¥çœ‹v2ç‰ˆæœ¬çš„è¯Šæ–­æŠ¥å‘Š
            </div>
        </div>
    </div>

    <script>
        // è¯Šæ–­ç³»ç»Ÿç±»
        class RestaurantDiagnosisAdvanced {
            constructor() {
                this.thresholds = {
                    food_cost_rate: 0.35,
                    labor_cost_rate: 0.30,
                    rent_cost_rate: 0.20,
                    marketing_cost_rate: 0.10,
                    utility_cost_rate: 0.05
                };

                this.industryBenchmarks = {
                    'å¿«é¤': { table_turnover: 4.0, gross_margin: 0.60, takeaway_ratio: 0.4, revenue_per_sqm: 6000, avg_spending: 35 },
                    'ç«é”…': { table_turnover: 3.5, gross_margin: 0.65, takeaway_ratio: 0.3, revenue_per_sqm: 7000, avg_spending: 80 },
                    'æ­£é¤': { table_turnover: 2.5, gross_margin: 0.58, takeaway_ratio: 0.25, revenue_per_sqm: 5500, avg_spending: 70 },
                    'èŒ¶é¤å…': { table_turnover: 3.0, gross_margin: 0.55, takeaway_ratio: 0.3, revenue_per_sqm: 5000, avg_spending: 45 },
                    'å’–å•¡å…': { table_turnover: 2.0, gross_margin: 0.70, takeaway_ratio: 0.4, revenue_per_sqm: 4500, avg_spending: 40 },
                    'èŒ¶é¥®åº—': { table_turnover: 5.0, gross_margin: 0.65, takeaway_ratio: 0.6, revenue_per_sqm: 8000, avg_spending: 25 },
                    'å…¶ä»–': { table_turnover: 3.0, gross_margin: 0.55, takeaway_ratio: 0.3, revenue_per_sqm: 5000, avg_spending: 50 }
                };
            }

            calculateKPI(data) {
                const totalCost = (data.food_cost || 0) + (data.labor_cost || 0) + (data.rent_cost || 0) + 
                                (data.marketing_cost || 0) + (data.utility_cost || 0);
                
                const estimatedEmployees = Math.max(1, Math.round((data.labor_cost || 0) / 5000));
                
                return {
                    total_cost: totalCost,
                    net_profit: (data.monthly_revenue || 0) - totalCost,
                    net_profit_rate: (data.monthly_revenue || 0) > 0 ? (data.monthly_revenue - totalCost) / data.monthly_revenue : 0,
                    gross_margin: (data.monthly_revenue || 0) > 0 ? ((data.monthly_revenue || 0) - (data.food_cost || 0)) / data.monthly_revenue : 0,
                    revenue_per_sqm: (data.monthly_revenue || 0) / (data.area || 1),
                    revenue_per_employee: (data.monthly_revenue || 0) / estimatedEmployees,
                    avg_spending: data.avg_order_value || 50,
                    table_turnover: (data.monthly_revenue || 0) / 30 / (data.avg_order_value || 50) / (data.seats || 1),
                    location_match_score: this.calculateLocationMatchScore(data),
                    content_marketing_index: this.calculateContentMarketingIndex(data),
                    marketing_health_score: this.calculateMarketingHealthScore(data),
                    estimated_employees: estimatedEmployees
                };
            }

            calculateLocationMatchScore(data) {
                let score = 0;
                
                const businessCircleScores = {
                    'ä¸€ç±»å•†åœˆ': 90,
                    'äºŒç±»å•†åœˆ': 75,
                    'ä¸‰ç±»å•†åœˆ': 60,
                    'ç¤¾åŒºå•†åœˆ': 50
                };
                
                score += businessCircleScores[data.location] || 60;
                
                const decorationScores = {
                    'ä¸­é«˜æ¡£': 90,
                    'ä¸­æ¡£': 75,
                    'ä¸­ä½æ¡£': 60
                };
                
                score += decorationScores[data.decoration_level] || 60;
                
                return Math.round(score);
            }

            calculateContentMarketingIndex(data) {
                let score = 0;
                
                const videoCount = data.video_count || 0;
                const liveCount = data.live_count || 0;
                
                score += Math.min(30, videoCount * 0.5);
                score += Math.min(20, liveCount * 1);
                
                const marketingSituationScore = {
                    'å¾ˆå¥½': 30,
                    'ä¸€èˆ¬': 20,
                    'è¾ƒå·®': 10,
                    'æ— ': 0
                };
                score += marketingSituationScore[data.marketing_situation] || 15;
                
                return Math.round(score);
            }

            calculateMarketingHealthScore(data) {
                let score = 0;
                
                const onlineRevenueRate = (data.online_revenue || 0) / (data.monthly_revenue || 1);
                score += Math.min(40, onlineRevenueRate * 100);
                
                const contentScore = this.calculateContentMarketingIndex(data) * 0.6;
                score += contentScore;
                
                return Math.round(score);
            }

            getHealthLevel(score) {
                if (score >= 85) return { class: 'health-excellent', label: 'ä¼˜ç§€' };
                if (score >= 70) return { class: 'health-good', label: 'è‰¯å¥½' };
                if (score >= 60) return { class: 'health-warning', label: 'å¾…æ”¹å–„' };
                return { class: 'health-danger', label: 'è­¦ç¤º' };
            }

            calculateCostControlScore(data) {
                const foodCostRate = (data.food_cost || 0) / (data.monthly_revenue || 1) * 100;
                const laborCostRate = (data.labor_cost || 0) / (data.monthly_revenue || 1) * 100;
                const totalCostRate = foodCostRate + laborCostRate + (data.rent_cost || 0) / (data.monthly_revenue || 1) * 100;
                
                let score = 100;
                if (foodCostRate > 40) score -= 20;
                if (laborCostRate > 35) score -= 15;
                if (totalCostRate > 85) score -= 25;
                
                return Math.max(0, Math.min(100, score));
            }

            calculateRevenueAbilityScore(data) {
                const monthlyRevenue = data.monthly_revenue || 0;
                const area = data.area || 1;
                const seats = data.seats || 1;
                
                const revenuePerSqm = monthlyRevenue / area;
                const revenuePerSeat = monthlyRevenue / seats;
                
                let score = 50;
                if (revenuePerSqm > 1000) score += 20;
                if (revenuePerSeat > 3000) score += 20;
                if (monthlyRevenue > 200000) score += 10;
                
                return Math.max(0, Math.min(100, score));
            }

            calculateOperationEfficiencyScore(data) {
                const dailyCustomers = Math.round((data.monthly_revenue || 0) / 30 / (data.avg_order_value || 50));
                const seats = data.seats || 1;
                const turnoverRate = dailyCustomers / seats;
                
                let score = 50;
                if (turnoverRate > 2) score += 25;
                if (turnoverRate > 3) score += 15;
                if (dailyCustomers > 200) score += 10;
                
                return Math.max(0, Math.min(100, score));
            }

            calculateCustomerExperienceScore(data) {
                const satisfaction = data.customer_satisfaction || 70;
                const repeatRate = data.repeat_customer_rate || 30;
                
                let score = satisfaction * 0.7 + repeatRate * 0.3;
                return Math.max(0, Math.min(100, score));
            }

            generateReport(data, kpi, benchmark) {
                const overallScore = Math.round((kpi.location_match_score + kpi.marketing_health_score + kpi.content_marketing_index) / 3);
                const healthLevel = this.getHealthLevel(overallScore);
                
                return `
                    <div class="diagnosis-report-v2">
                        ${this.generateStoreOverview(data, overallScore, healthLevel)}
                        ${this.generateDashboardSection(kpi, data)}
                        ${this.generateCostAnalysisSection(data, kpi)}
                        ${this.generateRevenueSection(data, kpi)}
                        ${this.generateOperationsSection(data, kpi)}
                        ${this.generateMarketingSection(data, kpi)}
                        ${this.generateAISuggestions(data, kpi)}
                        ${this.generateAdminEditor()}
                    </div>
                `;
            }

            generateStoreOverview(data, overallScore, healthLevel) {
                const businessType = data.business_type || 'å¿«é¤';
                const location = data.location || 'ä¸€ç±»å•†åœˆ';
                const area = data.area || 120;
                const seats = data.seats || 50;
                const monthlyRevenue = data.monthly_revenue || 150000;
                const dailyCustomers = Math.round(monthlyRevenue / 30 / (data.avg_order_value || 50));
                const decorationLevel = data.decoration_level || 'ä¸­æ¡£';

                return `
                    <div class="store-overview-card">
                        <h2 style="margin: 0 0 8px 0; font-size: 24px; font-weight: 700;">
                            ğŸ“ ${data.store_name || 'æœé˜³è·¯å¿«é¤åº—'} ï½œ ${businessType}ä¸šæ€ ï½œ ${location}
                        </h2>
                        <div class="store-info-grid">
                            <div class="store-info-item">
                                <span class="store-info-icon">ğŸ </span>
                                <span>é¢ç§¯ï¼š${area}ã¡ ï½œ åº§ä½æ•°ï¼š${seats}ä¸ª</span>
                            </div>
                            <div class="store-info-item">
                                <span class="store-info-icon">ğŸ’°</span>
                                <span>æœˆè¥æ”¶ï¼šÂ¥${this.formatNumber(monthlyRevenue)} ï½œ æ—¥å‡å®¢æµï¼š${dailyCustomers}äºº</span>
                            </div>
                            <div class="store-info-item">
                                <span class="store-info-icon">âš™ï¸</span>
                                <span>è£…ä¿®æ¡£æ¬¡ï¼š${decorationLevel} ï½œ ç»¼åˆå¾—åˆ†ï¼š${overallScore}åˆ†</span>
                            </div>
                        </div>
                        <div class="health-level-badge ${healthLevel.class}">
                            ${healthLevel.label}
                        </div>
                    </div>
                `;
            }

            generateDashboardSection(kpi, data) {
                const costControl = this.calculateCostControlScore(data);
                const revenueAbility = this.calculateRevenueAbilityScore(data);
                const operationEfficiency = this.calculateOperationEfficiencyScore(data);
                const customerExperience = this.calculateCustomerExperienceScore(data);
                const marketingAbility = kpi.marketing_health_score;

                return `
                    <div class="diagnosis-section">
                        <h3>ğŸ“Š æ ¸å¿ƒç»è¥æŒ‡æ ‡æ€»è§ˆ</h3>
                        <div class="dashboard-container">
                            <div class="gauge-chart">
                                <h4>æ€»ç›ˆåˆ©è¯„åˆ†</h4>
                                <div id="profitGauge" style="height: 200px;"></div>
                                <div style="margin-top: 16px;">
                                    <div style="font-size: 32px; font-weight: 700; color: #3b82f6;">
                                        ${Math.round((costControl + revenueAbility + operationEfficiency + customerExperience) / 4)}åˆ†
                                    </div>
                                    <div style="color: #6b7280; margin-top: 8px;">
                                        ç»¼åˆç»è¥å¥åº·åº¦è¯„åˆ†
                                    </div>
                                </div>
                            </div>
                            <div class="radar-chart">
                                <h4>äº”ç»´èƒ½åŠ›é›·è¾¾å›¾</h4>
                                <div id="radarChart" style="height: 200px;"></div>
                                <div style="margin-top: 16px; font-size: 12px; color: #6b7280;">
                                    <div>æˆæœ¬æ§åˆ¶åŠ›: ${costControl}åˆ†</div>
                                    <div>è¥æ”¶èƒ½åŠ›: ${revenueAbility}åˆ†</div>
                                    <div>è¿è¥æ•ˆç‡: ${operationEfficiency}åˆ†</div>
                                    <div>å®¢æˆ·ä½“éªŒ: ${customerExperience}åˆ†</div>
                                    <div>è¥é”€èƒ½åŠ›: ${marketingAbility}åˆ†</div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            generateCostAnalysisSection(data, kpi) {
                const monthlyRevenue = data.monthly_revenue || 150000;
                const foodCost = data.food_cost || 55000;
                const laborCost = data.labor_cost || 46000;
                const rentCost = data.rent_cost || 27600;
                const utilityCost = data.utility_cost || 7350;
                const marketingCost = data.marketing_cost || 13800;
                
                const foodCostRate = (foodCost / monthlyRevenue * 100).toFixed(1);
                const laborCostRate = (laborCost / monthlyRevenue * 100).toFixed(1);
                const rentCostRate = (rentCost / monthlyRevenue * 100).toFixed(1);
                const utilityCostRate = (utilityCost / monthlyRevenue * 100).toFixed(1);
                const marketingCostRate = (marketingCost / monthlyRevenue * 100).toFixed(1);
                
                const totalCostRate = parseFloat(foodCostRate) + parseFloat(laborCostRate) + parseFloat(rentCostRate) + 
                                     parseFloat(utilityCostRate) + parseFloat(marketingCostRate);

                return `
                    <div class="diagnosis-section">
                        <h3>ğŸ’° æˆæœ¬ç»“æ„åˆ†æ</h3>
                        <div class="cost-analysis-container">
                            <div class="pie-chart-container">
                                <h4>æˆæœ¬ç»“æ„åˆ†å¸ƒ</h4>
                                <div id="costPieChart" style="height: 200px;"></div>
                                <div style="margin-top: 16px; font-size: 14px;">
                                    <div style="display: flex; align-items: center; margin: 4px 0;">
                                        <span style="color: #3b82f6;">ğŸ±</span>
                                        <span style="margin-left: 8px;">é£Ÿæï¼š${foodCostRate}%</span>
                                    </div>
                                    <div style="display: flex; align-items: center; margin: 4px 0;">
                                        <span style="color: #10b981;">ğŸ‘·</span>
                                        <span style="margin-left: 8px;">äººåŠ›ï¼š${laborCostRate}%</span>
                                    </div>
                                    <div style="display: flex; align-items: center; margin: 4px 0;">
                                        <span style="color: #f59e0b;">ğŸ¢</span>
                                        <span style="margin-left: 8px;">ç§Ÿé‡‘ï¼š${rentCostRate}%</span>
                                    </div>
                                    <div style="display: flex; align-items: center; margin: 4px 0;">
                                        <span style="color: #8b5cf6;">âš¡</span>
                                        <span style="margin-left: 8px;">æ°´ç”µæ°”ï¼š${utilityCostRate}%</span>
                                    </div>
                                    <div style="display: flex; align-items: center; margin: 4px 0;">
                                        <span style="color: #ef4444;">ğŸ“£</span>
                                        <span style="margin-left: 8px;">è¥é”€ï¼š${marketingCostRate}%</span>
                                    </div>
                                </div>
                            </div>
                            <div class="alert-panel">
                                <h4>ğŸš¨ æˆæœ¬é¢„è­¦</h4>
                                ${this.generateCostAlerts(foodCostRate, totalCostRate)}
                            </div>
                        </div>
                    </div>
                `;
            }

            generateCostAlerts(foodCostRate, totalCostRate) {
                let alerts = [];
                
                if (parseFloat(foodCostRate) > 40) {
                    alerts.push(`
                        <div class="alert-item alert-warning">
                            <span>âš ï¸</span>
                            <div>
                                <strong>é£Ÿææˆæœ¬ç‡åé«˜ï¼ˆ${foodCostRate}%ï¼‰</strong><br>
                                <small>å»ºè®®ä¼˜åŒ–ä¾›åº”é“¾ï¼Œå¯»æ‰¾æ›´ä¼˜è´¨çš„ä¾›åº”å•†</small>
                            </div>
                        </div>
                    `);
                }
                
                if (totalCostRate > 85) {
                    alerts.push(`
                        <div class="alert-item alert-danger">
                            <span>ğŸ”´</span>
                            <div>
                                <strong>ç»¼åˆæˆæœ¬ç‡${totalCostRate.toFixed(1)}%</strong><br>
                                <small>ç›ˆåˆ©ç©ºé—´ä¸¥é‡ä¸è¶³ï¼Œéœ€è¦ç«‹å³ä¼˜åŒ–æˆæœ¬ç»“æ„</small>
                            </div>
                        </div>
                    `);
                }
                
                if (alerts.length === 0) {
                    alerts.push(`
                        <div class="alert-item alert-info">
                            <span>âœ…</span>
                            <div>
                                <strong>æˆæœ¬æ§åˆ¶è‰¯å¥½</strong><br>
                                <small>å„é¡¹æˆæœ¬æŒ‡æ ‡å‡åœ¨åˆç†èŒƒå›´å†…</small>
                            </div>
                        </div>
                    `);
                }
                
                return alerts.join('');
            }

            generateRevenueSection(data, kpi) {
                const monthlyRevenue = data.monthly_revenue || 150000;
                const onlineRevenue = data.online_revenue || (monthlyRevenue * 0.3);
                const offlineRevenue = monthlyRevenue - onlineRevenue;
                const onlineRate = (onlineRevenue / monthlyRevenue * 100).toFixed(1);
                
                const area = data.area || 120;
                const seats = data.seats || 50;
                const dailyCustomers = Math.round(monthlyRevenue / 30 / (data.avg_order_value || 50));
                
                const revenuePerSqm = Math.round(monthlyRevenue / area);
                const revenuePerSeat = Math.round(monthlyRevenue / seats);
                const seatUtilization = Math.round(dailyCustomers / seats * 100);

                return `
                    <div class="diagnosis-section">
                        <h3>ğŸ“ˆ è¥æ”¶ç»“æ„ä¸ç›ˆåˆ©èƒ½åŠ›</h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin: 24px 0;">
                            <div style="background: white; border-radius: 12px; padding: 24px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                                <h4>è¥æ”¶æ¥æºå¯¹æ¯”</h4>
                                <div id="revenueChart" style="height: 200px;"></div>
                                <div style="margin-top: 16px;">
                                    <div style="display: flex; justify-content: space-between; margin: 8px 0;">
                                        <span>çº¿ä¸‹è¥æ”¶ï¼šÂ¥${this.formatNumber(offlineRevenue)}</span>
                                        <span style="color: #3b82f6;">${(100 - onlineRate)}%</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; margin: 8px 0;">
                                        <span>çº¿ä¸Šè¥æ”¶ï¼šÂ¥${this.formatNumber(onlineRevenue)}</span>
                                        <span style="color: #10b981;">${onlineRate}% ${onlineRate > 30 ? 'â†‘' : 'â†“'}</span>
                                    </div>
                                </div>
                            </div>
                            <div style="background: white; border-radius: 12px; padding: 24px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                                <h4>å…³é”®æŒ‡æ ‡å¡ç‰‡</h4>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                                    <div style="text-align: center; padding: 16px; background: #f8fafc; border-radius: 8px;">
                                        <div style="font-size: 20px; font-weight: 700; color: #3b82f6;">Â¥${revenuePerSqm}</div>
                                        <div style="font-size: 12px; color: #6b7280;">åªæ•ˆ</div>
                                    </div>
                                    <div style="text-align: center; padding: 16px; background: #f8fafc; border-radius: 8px;">
                                        <div style="font-size: 20px; font-weight: 700; color: #10b981;">Â¥${revenuePerSeat}</div>
                                        <div style="font-size: 12px; color: #6b7280;">äººæ•ˆ</div>
                                    </div>
                                    <div style="text-align: center; padding: 16px; background: #f8fafc; border-radius: 8px;">
                                        <div style="font-size: 20px; font-weight: 700; color: #f59e0b;">Â¥${data.avg_order_value || 50}</div>
                                        <div style="font-size: 12px; color: #6b7280;">å®¢å•ä»·</div>
                                    </div>
                                    <div style="text-align: center; padding: 16px; background: #f8fafc; border-radius: 8px;">
                                        <div style="font-size: 20px; font-weight: 700; color: #8b5cf6;">${seatUtilization}%</div>
                                        <div style="font-size: 12px; color: #6b7280;">åº§ä½åˆ©ç”¨ç‡</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            generateOperationsSection(data, kpi) {
                const dailyCustomers = Math.round((data.monthly_revenue || 0) / 30 / (data.avg_order_value || 50));
                const seats = data.seats || 50;
                const turnoverRate = (dailyCustomers / seats).toFixed(1);
                const satisfaction = data.customer_satisfaction || 75;
                const repeatRate = data.repeat_customer_rate || 30;

                return `
                    <div class="diagnosis-section">
                        <h3>ğŸ‘¥ è¿è¥æ•ˆç‡ä¸å®¢æˆ·ä½“éªŒåˆ†æ</h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin: 24px 0;">
                            <div style="background: white; border-radius: 12px; padding: 24px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                                <h4>å®¢æµè¶‹åŠ¿åˆ†æ</h4>
                                <div id="customerTrendChart" style="height: 200px;"></div>
                                <div style="margin-top: 16px;">
                                    <div style="display: flex; justify-content: space-between; margin: 8px 0;">
                                        <span>æ—¥å‡å®¢æµï¼š${dailyCustomers}äºº</span>
                                        <span style="color: #3b82f6;">${dailyCustomers > 150 ? 'â†‘' : 'â†“'}</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; margin: 8px 0;">
                                        <span>ç¿»å°ç‡ï¼š${turnoverRate}æ¬¡</span>
                                        <span style="color: #10b981;">${turnoverRate > 2 ? 'â†‘' : 'â†“'}</span>
                                    </div>
                                </div>
                            </div>
                            <div style="background: white; border-radius: 12px; padding: 24px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                                <h4>å®¢æˆ·ä½“éªŒè¯„åˆ†</h4>
                                <div style="text-align: center; margin-bottom: 20px;">
                                    <div style="font-size: 48px; font-weight: 700; color: #3b82f6;">${satisfaction}</div>
                                    <div style="color: #6b7280;">å®¢æˆ·æ»¡æ„åº¦</div>
                                </div>
                                <div style="margin-top: 16px;">
                                    <div style="display: flex; justify-content: space-between; margin: 8px 0;">
                                        <span>å¤è´­ç‡ï¼š${repeatRate}%</span>
                                        <span style="color: #10b981;">${repeatRate > 40 ? 'â†‘' : 'â†“'}</span>
                                    </div>
                                    <div style="margin-top: 12px; padding: 12px; background: #f8fafc; border-radius: 8px; font-size: 14px;">
                                        <strong>ä½“éªŒåˆ†æï¼š</strong>è¯¥åº—åœ¨æœåŠ¡æ»¡æ„åº¦æ–¹é¢è¡¨ç°è‰¯å¥½ï¼Œä½†å£å‘³é—®é¢˜å æ¯”32%ï¼Œå»ºè®®é‡ç‚¹ä¼˜åŒ–ä¸»èœå‡ºå“ã€‚
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            generateMarketingSection(data, kpi) {
                const videoCount = data.video_count || 80;
                const liveCount = data.live_count || 20;
                const marketingIndex = kpi.content_marketing_index || 75;

                return `
                    <div class="diagnosis-section">
                        <h3>ğŸ“± å†…å®¹è¥é”€ä¸çº¿ä¸Šè¡¨ç°</h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin: 24px 0;">
                            <div style="background: white; border-radius: 12px; padding: 24px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                                <h4>è¥é”€æŒ‡æ ‡å¡</h4>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                                    <div style="text-align: center; padding: 16px; background: #f8fafc; border-radius: 8px;">
                                        <div style="font-size: 20px; font-weight: 700; color: #3b82f6;">${videoCount}æ¡</div>
                                        <div style="font-size: 12px; color: #6b7280;">çŸ­è§†é¢‘å‘å¸ƒé‡/æœˆ</div>
                                    </div>
                                    <div style="text-align: center; padding: 16px; background: #f8fafc; border-radius: 8px;">
                                        <div style="font-size: 20px; font-weight: 700; color: #10b981;">${liveCount}åœº</div>
                                        <div style="font-size: 12px; color: #6b7280;">ç›´æ’­åœºæ¬¡/æœˆ</div>
                                    </div>
                                    <div style="text-align: center; padding: 16px; background: #f8fafc; border-radius: 8px; grid-column: 1 / -1;">
                                        <div style="font-size: 20px; font-weight: 700; color: #f59e0b;">${marketingIndex}/100</div>
                                        <div style="font-size: 12px; color: #6b7280;">è¥é”€æŒ‡æ•°</div>
                                    </div>
                                </div>
                            </div>
                            <div style="background: white; border-radius: 12px; padding: 24px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                                <h4>å†…å®¹å¢é•¿è¶‹åŠ¿</h4>
                                <div id="marketingTrendChart" style="height: 200px;"></div>
                                <div style="margin-top: 16px; padding: 12px; background: #f8fafc; border-radius: 8px; font-size: 14px;">
                                    <strong>AIå»ºè®®ï¼š</strong>å½“å‰å†…å®¹äº§é‡å……è¶³ï¼Œä½†å»ºè®®æé«˜è§†é¢‘è´¨é‡å¹¶å»ºç«‹è¾¾äººåˆä½œæœºåˆ¶ã€‚
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            generateAISuggestions(data, kpi) {
                const suggestions = this.generateAISuggestionList(data, kpi);
                
                return `
                    <div class="diagnosis-section">
                        <h3>ğŸ§© AIæ™ºèƒ½å»ºè®®åŒº</h3>
                        <div style="margin: 16px 0;">
                            ${suggestions.map(suggestion => `
                                <div class="ai-suggestion-card priority-${suggestion.priority}">
                                    <div class="suggestion-header" onclick="toggleSuggestion(this)">
                                        <div>
                                            <strong>${suggestion.icon} ${suggestion.title}</strong>
                                            <div style="font-size: 12px; color: #6b7280; margin-top: 4px;">
                                                ä¼˜å…ˆçº§ï¼š${suggestion.priority === 'high' ? 'é«˜' : suggestion.priority === 'medium' ? 'ä¸­' : 'ä½'}
                                            </div>
                                        </div>
                                        <div style="color: #6b7280;">â–¼</div>
                                    </div>
                                    <div class="suggestion-content">
                                        <div style="margin-bottom: 12px;">
                                            <strong>é—®é¢˜ï¼š</strong>${suggestion.problem}
                                        </div>
                                        <div style="margin-bottom: 12px;">
                                            <strong>æ–¹æ¡ˆï¼š</strong>${suggestion.solution}
                                        </div>
                                        <div style="display: flex; justify-content: space-between; align-items: center;">
                                            <div style="color: #10b981; font-weight: 600;">
                                                é¢„æœŸæ”¶ç›Šï¼š${suggestion.expectedBenefit}
                                            </div>
                                            <div style="display: flex; gap: 8px;">
                                                <button class="editor-btn" onclick="editSuggestion(this)">âœï¸ ç¼–è¾‘</button>
                                                <button class="editor-btn" onclick="copyToAdmin(this)">ğŸ“‹ å¤åˆ¶åˆ°ç®¡ç†å‘˜åŒº</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }

            generateAISuggestionList(data, kpi) {
                const suggestions = [];
                
                // æˆæœ¬ä¼˜åŒ–å»ºè®®
                const foodCostRate = (data.food_cost || 0) / (data.monthly_revenue || 1) * 100;
                if (foodCostRate > 40) {
                    suggestions.push({
                        icon: 'ğŸ¯',
                        title: 'æˆæœ¬ä¼˜åŒ–æ–¹æ¡ˆ',
                        priority: 'high',
                        problem: 'é£Ÿææˆæœ¬ç‡åé«˜ï¼ˆ' + foodCostRate.toFixed(1) + '%ï¼‰ï¼Œå½±å“ç›ˆåˆ©èƒ½åŠ›',
                        solution: 'ä¼˜åŒ–ä¾›åº”å•†ã€å¼•å…¥è‡ªåŠ©ç‚¹é¤ã€èŠ‚èƒ½è®¾å¤‡æ”¹é€ ',
                        expectedBenefit: 'Â¥10,000/æœˆ'
                    });
                }
                
                // è¥æ”¶æå‡å»ºè®®
                const monthlyRevenue = data.monthly_revenue || 0;
                if (monthlyRevenue < 200000) {
                    suggestions.push({
                        icon: 'ğŸ“ˆ',
                        title: 'è¥æ”¶æå‡ç­–ç•¥',
                        priority: 'medium',
                        problem: 'æœˆè¥æ”¶åä½ï¼Œéœ€è¦æå‡å®¢æµé‡å’Œå®¢å•ä»·',
                        solution: 'æ¨å‡ºå¥—é¤ä¼˜æƒ ã€å¢åŠ å¤–å–æ¸ é“ã€ä¼˜åŒ–èœå“ç»“æ„',
                        expectedBenefit: 'è¥æ”¶å¢é•¿15%'
                    });
                }
                
                // å®¢æˆ·ä½“éªŒä¼˜åŒ–
                const satisfaction = data.customer_satisfaction || 0;
                if (satisfaction < 80) {
                    suggestions.push({
                        icon: 'ğŸ‘¥',
                        title: 'å®¢æˆ·ä½“éªŒä¼˜åŒ–',
                        priority: 'medium',
                        problem: 'å®¢æˆ·æ»¡æ„åº¦æœ‰å¾…æå‡ï¼ˆ' + satisfaction + 'åˆ†ï¼‰',
                        solution: 'åŠ å¼ºå‘˜å·¥åŸ¹è®­ã€ä¼˜åŒ–æœåŠ¡æµç¨‹ã€æ”¹å–„å°±é¤ç¯å¢ƒ',
                        expectedBenefit: 'æ»¡æ„åº¦æå‡è‡³85åˆ†'
                    });
                }
                
                // è¥é”€æ¨å¹¿å»ºè®®
                const marketingIndex = kpi.content_marketing_index || 0;
                if (marketingIndex < 80) {
                    suggestions.push({
                        icon: 'ğŸ“±',
                        title: 'è¥é”€æ¨å¹¿ä¼˜åŒ–',
                        priority: 'low',
                        problem: 'å†…å®¹è¥é”€æŒ‡æ•°åä½ï¼ˆ' + marketingIndex + 'åˆ†ï¼‰',
                        solution: 'å¢åŠ çŸ­è§†é¢‘å‘å¸ƒé¢‘ç‡ã€å»ºç«‹è¾¾äººåˆä½œã€ä¼˜åŒ–å†…å®¹è´¨é‡',
                        expectedBenefit: 'è¥é”€æŒ‡æ•°æå‡è‡³85åˆ†'
                    });
                }
                
                return suggestions;
            }

            generateAdminEditor() {
                return `
                    <div class="diagnosis-section">
                        <h3>âœï¸ ç®¡ç†å‘˜ä¸“å±å»ºè®®åŒº</h3>
                        <div class="admin-editor">
                            <div class="editor-toolbar">
                                <button class="editor-btn" onclick="formatText('bold')"><strong>B</strong></button>
                                <button class="editor-btn" onclick="formatText('italic')"><em>I</em></button>
                                <button class="editor-btn" onclick="formatText('underline')"><u>U</u></button>
                                <button class="editor-btn" onclick="insertHeading()">H1</button>
                                <button class="editor-btn" onclick="insertTable()">è¡¨æ ¼</button>
                                <button class="editor-btn" onclick="insertIcon()">å›¾æ ‡</button>
                                <button class="editor-btn" onclick="saveAdminNotes()">ä¿å­˜</button>
                                <button class="editor-btn" onclick="exportPDF()">å¯¼å‡ºPDF</button>
                            </div>
                            <div class="editor-content" contenteditable="true" id="adminEditor">
                                <h3>ç«‹å³è¡ŒåŠ¨é¡¹ï¼ˆ1å‘¨å†…ï¼‰</h3>
                                <ul>
                                    <li>ä¼˜åŒ–é£Ÿæé‡‡è´­æ¸ é“ï¼Œé™ä½é£Ÿææˆæœ¬</li>
                                    <li>åŠ å¼ºå‘˜å·¥æœåŠ¡åŸ¹è®­</li>
                                </ul>
                                
                                <h3>çŸ­æœŸæ”¹è¿›é¡¹ï¼ˆæœ¬æœˆï¼‰</h3>
                                <ul>
                                    <li>æ¨å‡ºæ–°èœå“å¸å¼•å®¢æˆ·</li>
                                    <li>ä¼˜åŒ–åº—å†…å¸ƒå±€æå‡ç¿»å°ç‡</li>
                                </ul>
                                
                                <h3>ä¸­é•¿æœŸè§„åˆ’ï¼ˆ3ä¸ªæœˆå†…ï¼‰</h3>
                                <ul>
                                    <li>è€ƒè™‘å¼€è®¾åˆ†åº—</li>
                                    <li>å»ºç«‹ä¼šå‘˜ä½“ç³»</li>
                                </ul>
                                
                                <h3>ç‰¹åˆ«æé†’</h3>
                                <p>è¯·å®šæœŸå…³æ³¨æˆæœ¬æ§åˆ¶ï¼Œç¡®ä¿ç›ˆåˆ©ç©ºé—´ã€‚</p>
                                
                                <h3>åç»­è·Ÿè¿›æ—¥æœŸ</h3>
                                <p>ä¸‹æ¬¡è¯„ä¼°æ—¶é—´ï¼š${new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toLocaleDateString()}</p>
                            </div>
                        </div>
                    </div>
                `;
            }

            formatNumber(num) {
                if (num >= 10000) {
                    return (num / 10000).toFixed(1) + 'ä¸‡';
                }
                return num.toLocaleString();
            }
        }

        // å…¨å±€å˜é‡
        const diagnosis = new RestaurantDiagnosisAdvanced();

        // æµ‹è¯•æ•°æ®
        const testData = {
            id: 'TEST001',
            store_name: 'æœé˜³è·¯å¿«é¤åº—',
            business_type: 'å¿«é¤',
            location: 'ä¸€ç±»å•†åœˆ',
            area: 120,
            seats: 50,
            monthly_revenue: 150000,
            food_cost: 55000,
            labor_cost: 46000,
            rent_cost: 27600,
            utility_cost: 7350,
            marketing_cost: 13800,
            avg_order_value: 50,
            customer_satisfaction: 75,
            repeat_customer_rate: 30,
            decoration_level: 'ä¸­æ¡£',
            video_count: 80,
            live_count: 20
        };

        // ä¸»è¦åŠŸèƒ½å‡½æ•°
        function generateTestReport() {
            try {
                const kpi = diagnosis.calculateKPI(testData);
                const benchmark = diagnosis.industryBenchmarks[testData.business_type] || diagnosis.industryBenchmarks['å…¶ä»–'];
                
                const html = diagnosis.generateReport(testData, kpi, benchmark);
                document.getElementById('reportExport').innerHTML = html;
                
                console.log('æŠ¥å‘Šç”ŸæˆæˆåŠŸ');
            } catch (error) {
                console.error('æŠ¥å‘Šç”Ÿæˆå¤±è´¥:', error);
                alert('æŠ¥å‘Šç”Ÿæˆå¤±è´¥: ' + error.message);
            }
        }

        function exportToPDF() {
            const reportContent = document.getElementById('reportExport');
            
            if (typeof html2pdf !== 'undefined') {
                const opt = {
                    margin: 1,
                    filename: 'é¤é¥®åº—è¯Šæ–­æŠ¥å‘Š_v2.pdf',
                    image: { type: 'jpeg', quality: 0.98 },
                    html2canvas: { scale: 2 },
                    jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
                };
                
                html2pdf().set(opt).from(reportContent).save();
            } else {
                alert('PDFå¯¼å‡ºåŠŸèƒ½éœ€è¦åŠ è½½html2pdfåº“');
            }
        }

        function exportToImage() {
            const reportContent = document.getElementById('reportExport');
            
            html2canvas(reportContent, {
                scale: 2,
                useCORS: true,
                allowTaint: true
            }).then(canvas => {
                const link = document.createElement('a');
                link.download = 'é¤é¥®åº—è¯Šæ–­æŠ¥å‘Š_v2.png';
                link.href = canvas.toDataURL('image/png');
                link.click();
            }).catch(error => {
                console.error('å¯¼å‡ºå›¾ç‰‡å¤±è´¥:', error);
                alert('å¯¼å‡ºå›¾ç‰‡å¤±è´¥ï¼Œè¯·é‡è¯•');
            });
        }

        function changeTheme(theme) {
            const reportExport = document.getElementById('reportExport');
            reportExport.className = `diagnosis-report-v2 theme-${theme}`;
            
            // ä¿å­˜ä¸»é¢˜é€‰æ‹©
            localStorage.setItem('selectedTheme', theme);
        }

        // JavaScriptäº¤äº’åŠŸèƒ½
        function toggleSuggestion(header) {
            const content = header.nextElementSibling;
            const arrow = header.querySelector('div:last-child');
            
            if (content.classList.contains('expanded')) {
                content.classList.remove('expanded');
                arrow.textContent = 'â–¼';
            } else {
                content.classList.add('expanded');
                arrow.textContent = 'â–²';
            }
        }

        function editSuggestion(button) {
            const suggestionCard = button.closest('.ai-suggestion-card');
            const content = suggestionCard.querySelector('.suggestion-content');
            
            // åˆ›å»ºç¼–è¾‘æ¨¡å¼
            const problemDiv = content.querySelector('div:first-child');
            const solutionDiv = content.querySelector('div:nth-child(2)');
            
            const problemText = problemDiv.textContent.replace('é—®é¢˜ï¼š', '').trim();
            const solutionText = solutionDiv.textContent.replace('æ–¹æ¡ˆï¼š', '').trim();
            
            problemDiv.innerHTML = `<strong>é—®é¢˜ï¼š</strong><input type="text" value="${problemText}" style="width: 100%; padding: 4px; border: 1px solid #ccc; border-radius: 4px;">`;
            solutionDiv.innerHTML = `<strong>æ–¹æ¡ˆï¼š</strong><textarea style="width: 100%; padding: 4px; border: 1px solid #ccc; border-radius: 4px; min-height: 60px;">${solutionText}</textarea>`;
            
            button.textContent = 'ğŸ’¾ ä¿å­˜';
            button.onclick = () => saveSuggestion(suggestionCard);
        }

        function saveSuggestion(suggestionCard) {
            const content = suggestionCard.querySelector('.suggestion-content');
            const problemInput = content.querySelector('input');
            const solutionTextarea = content.querySelector('textarea');
            
            const problemDiv = content.querySelector('div:first-child');
            const solutionDiv = content.querySelector('div:nth-child(2)');
            
            problemDiv.innerHTML = `<strong>é—®é¢˜ï¼š</strong>${problemInput.value}`;
            solutionDiv.innerHTML = `<strong>æ–¹æ¡ˆï¼š</strong>${solutionTextarea.value}`;
            
            const saveButton = content.querySelector('button');
            saveButton.textContent = 'âœï¸ ç¼–è¾‘';
            saveButton.onclick = () => editSuggestion(saveButton);
        }

        function copyToAdmin(button) {
            const suggestionCard = button.closest('.ai-suggestion-card');
            const title = suggestionCard.querySelector('strong').textContent;
            const problem = suggestionCard.querySelector('.suggestion-content div:first-child').textContent.replace('é—®é¢˜ï¼š', '').trim();
            const solution = suggestionCard.querySelector('.suggestion-content div:nth-child(2)').textContent.replace('æ–¹æ¡ˆï¼š', '').trim();
            
            const adminEditor = document.getElementById('adminEditor');
            const currentContent = adminEditor.innerHTML;
            
            adminEditor.innerHTML = currentContent + `
                <div style="margin-top: 16px; padding: 12px; background: #f0f9ff; border-left: 4px solid #3b82f6; border-radius: 4px;">
                    <h4>${title}</h4>
                    <p><strong>é—®é¢˜ï¼š</strong>${problem}</p>
                    <p><strong>æ–¹æ¡ˆï¼š</strong>${solution}</p>
                </div>
            `;
            
            // æ»šåŠ¨åˆ°ç®¡ç†å‘˜ç¼–è¾‘å™¨
            adminEditor.scrollIntoView({ behavior: 'smooth' });
        }

        function formatText(command) {
            document.execCommand(command, false, null);
        }

        function insertHeading() {
            const selection = window.getSelection();
            if (selection.rangeCount > 0) {
                const range = selection.getRangeAt(0);
                const heading = document.createElement('h3');
                heading.textContent = 'æ–°æ ‡é¢˜';
                range.insertNode(heading);
            }
        }

        function insertTable() {
            const table = `
                <table style="width: 100%; border-collapse: collapse; margin: 16px 0;">
                    <tr>
                        <th style="border: 1px solid #ccc; padding: 8px; background: #f5f5f5;">é¡¹ç›®</th>
                        <th style="border: 1px solid #ccc; padding: 8px; background: #f5f5f5;">é‡‘é¢</th>
                        <th style="border: 1px solid #ccc; padding: 8px; background: #f5f5f5;">å¤‡æ³¨</th>
                    </tr>
                    <tr>
                        <td style="border: 1px solid #ccc; padding: 8px;">ç¤ºä¾‹é¡¹ç›®</td>
                        <td style="border: 1px solid #ccc; padding: 8px;">Â¥0</td>
                        <td style="border: 1px solid #ccc; padding: 8px;">ç¤ºä¾‹å¤‡æ³¨</td>
                    </tr>
                </table>
            `;
            
            const adminEditor = document.getElementById('adminEditor');
            adminEditor.innerHTML += table;
        }

        function insertIcon() {
            const icons = ['ğŸ’°', 'ğŸ“Š', 'ğŸ¯', 'ğŸ“ˆ', 'ğŸ‘¥', 'ğŸ“±', 'âš ï¸', 'âœ…', 'âŒ', 'ğŸ’¡'];
            const icon = icons[Math.floor(Math.random() * icons.length)];
            
            const adminEditor = document.getElementById('adminEditor');
            adminEditor.innerHTML += `<span style="font-size: 20px; margin: 0 4px;">${icon}</span>`;
        }

        function saveAdminNotes() {
            const adminEditor = document.getElementById('adminEditor');
            const content = adminEditor.innerHTML;
            
            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            localStorage.setItem('adminNotes', content);
            
            // æ˜¾ç¤ºä¿å­˜æˆåŠŸæç¤º
            const button = event.target;
            const originalText = button.textContent;
            button.textContent = 'âœ… å·²ä¿å­˜';
            button.style.background = '#10b981';
            
            setTimeout(() => {
                button.textContent = originalText;
                button.style.background = '';
            }, 2000);
        }

        // åŠ è½½ä¿å­˜çš„ä¸»é¢˜å’Œç®¡ç†å‘˜ç¬”è®°
        document.addEventListener('DOMContentLoaded', function() {
            const savedTheme = localStorage.getItem('selectedTheme') || 'fresh';
            const themeSelector = document.getElementById('themeSelector');
            if (themeSelector) {
                themeSelector.value = savedTheme;
                changeTheme(savedTheme);
            }
            
            const savedNotes = localStorage.getItem('adminNotes');
            if (savedNotes) {
                const adminEditor = document.getElementById('adminEditor');
                if (adminEditor) {
                    adminEditor.innerHTML = savedNotes;
                }
            }
        });
    </script>
</body>
</html>
